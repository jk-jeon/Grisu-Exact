<html>
<head>
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1','packages':['controls', 'charteditor']}]}"></script>
<script src="https://web.archive.org/web/20160324220311/http://jquery-csv.googlecode.com/git/src/jquery.csv.js"></script>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
$(function() {
	google.load("visualization", "1", {packages:["corechart"]});

    var csv = $('#textInput').val();
    var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
    });

    // Convert data for bar chart (summing all digits)
    var timeData = {};	// type -> table
    var funcRowMap;
    var maxDigit = 0;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
      var digit = data[i][2];
   		var time = data[i][3];
   		if (timeData[type] == null) {
   			timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
        if (digit != 0)
   			  funcRowMap = {};
   		}

   		var table = timeData[type];
   		
      if (digit != 0) {
     		if (funcRowMap[func] == null)
     			funcRowMap[func] = table.push([func, 0]) - 1;
     		
     		table[funcRowMap[func]][1] += time;
      }
      else 
        table.push([func, time]);

      maxDigit = Math.max(maxDigit, digit);
    }

    // Compute average
    for (var type in timeData) {
      var table = timeData[type];
      for (var i = 1; i < table.length; i++)
        table[i][1] /= maxDigit;
    }

    // Convert data for drawing line chart per random digit
    var timeDigitData = {}; // type -> table
    var funcColumnMap;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
		  var digit = data[i][2];
   		var time = data[i][3];

      if (digit == 0)
        continue;

   		if (timeDigitData[type] == null) {
   			timeDigitData[type] = [["Digit"]];
   			funcColumnMap = {};
   		}

   		var table = timeDigitData[type];

   		if (funcColumnMap[func] == null)
   			funcColumnMap[func] = table[0].push(func) - 1;

   		var row;
   		for (row = 1; row < table.length; row++)
   			if (table[row][0] == digit)
   				break;

    	if (row == table.length)
    		table.push([digit]);

		table[row][funcColumnMap[func]] = time;
	}

	for (var type in timeData) {
		$("#main").append(
      $("<a>", {name: type}),
      $("<h2>", {style: "padding-top: 70px; margin-top: -70px;"}).append(type)
    );

    $("#section").append($("<li>").append($("<a>", {href: "#" + type}).append(type)));

		drawTable(type, timeData[type]);
		drawBarChart(type, timeData[type]);
    if (timeDigitData[type] != null)
		  drawDigitChart(type, timeDigitData[type]);
	}

	$(".chart").each(function() {
		var chart = $(this);
		var d = $("#downloadDD").clone().css("display", "");
		$('li a', d).each(function() {
	        $(this).click(function() {
	            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
	            svg=sanitize(svg);
	            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
	            $('#imageGetFormTYPE').val($(this).attr('dltype'));
	            $('#imageGetFormSVG').val(svg);
	            $('#imageGetForm').submit();
	        });
	    });		
		$(this).after(d);
	});

  // Add configurations
  var thisConfig = "unknown_win64_vc2019";
  var configurations = ["corei7920@2.67_cygwin32_gcc4.8","corei7920@2.67_cygwin64_gcc4.8","corei7920@2.67_win32_vc2013","corei7920@2.67_win64_vc2013","unknown_mac32_clang7.0","unknown_mac64_clang7.0","unknown_win64_vc2019"];

  for (var i in configurations) {
    var c = configurations[i];
    $("#configuration").append($("<li>", {class : (c == thisConfig ? "active" : "")}).append($("<a>", {href: c + ".html"}).append(c)));
  }
});

function drawTable(type, timeData) {
	var data = google.visualization.arrayToDataTable(timeData);
    data.addColumn('number', 'Speedup');
    data.sort([{ column: 1, desc: true }]);
    var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
    formatter1.format(data, 1);

	var div = document.createElement("div");
	div.className = "tablechart";
	$("#main").append(div);
    var table = new google.visualization.Table(div);
    redrawTable(0);
    table.setSelection([{ row: 0, column: null}]);

    function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
            data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({suffix: 'x'});
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
    }

    google.visualization.events.addListener(table, 'select',
    function() {
        var selection = table.getSelection();
        if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
                redrawTable(item.row);
        }
    });

}

function drawBarChart(type, timeData) {
    var defaultColors = ["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"];

	var data = google.visualization.arrayToDataTable(timeData);
	data.addColumn({ type: "string", role: "style" })
	for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
		data.setValue(rowIndex, 2, defaultColors[rowIndex]);

    data.sort([{ column: 1, desc: true }]);
	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '70%'},
		width: 800,
		height: 300,
		legend: { position: "none" },
		hAxis: { title: "Time (ns)" }
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_time");
	$("#main").append(div);
	var chart = new google.visualization.BarChart(div);

	chart.draw(data, options);
}

function drawDigitChart(type, timeDigitData) {
	var data = google.visualization.arrayToDataTable(timeDigitData);

	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '80%'},
		hAxis: {
			title: "Digit",
			gridlines: { count: timeDigitData.length - 1 },
			maxAlternation: 1,
			minTextSpacing: 0
		},
		vAxis: {
			title: "Time (ns) in log scale",
			logScale: true,
			minorGridlines: { count: 10 },
      baseline: 0
		},
		width: 800,
		height: 600
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_timedigit");
	$("#main").append(div);
	var chart = new google.visualization.LineChart(div);

	chart.draw(data, options);
}

// http://jsfiddle.net/P6XXM/
function sanitize(svg) {
    svg = svg
        .replace(/\<svg/,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
    /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
    /* This fails in IE < 8
    .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
    return s2 +'.'+ s3[0];
    })*/

    // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
            return s.toLowerCase();
        });

    // IE9 beta bugs with innerHTML. Test again with final IE9.
    svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
    if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
    }

    return svg;
}
</script>
<style type="text/css">
@media (min-width: 800px) {
  .container {
    max-width: 800px;
  }
}
textarea {
	font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
.tablechart {
	width: 700px;
	margin: auto;
	padding-top: 20px;
	padding-bottom: 20px;
}
.chart {
	padding-top: 20px;
	padding-bottom: 20px;
}
body { padding-top: 70px; }
</style>
</head>
<body>
<div class="container">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/miloyip/dtoa-benchmark"><span class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="configuration">
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="section">
          </ul>
        </li>
      </ul>
      <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo Yip</a></p>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="page-header">
<h1 id="title">unknown_win64_vc2019</h1>
</div>
<div id="main"></div>
<h2>Source CSV</h2>
<textarea id="textInput" class="form-control" rows="5" readonly>
  Type,Function,Digit,Time(ns)
randomdigit,doubleconv,1,99.878000
randomdigit,doubleconv,2,111.861000
randomdigit,doubleconv,3,118.309000
randomdigit,doubleconv,4,124.448000
randomdigit,doubleconv,5,129.179000
randomdigit,doubleconv,6,135.613000
randomdigit,doubleconv,7,137.398000
randomdigit,doubleconv,8,139.738000
randomdigit,doubleconv,9,138.119000
randomdigit,doubleconv,10,141.317000
randomdigit,doubleconv,11,143.200000
randomdigit,doubleconv,12,150.223000
randomdigit,doubleconv,13,150.209000
randomdigit,doubleconv,14,154.408000
randomdigit,doubleconv,15,173.977000
randomdigit,doubleconv,16,159.569000
randomdigit,doubleconv,17,171.488000
randomdigit,emyg,1,73.921000
randomdigit,emyg,2,78.809000
randomdigit,emyg,3,82.617000
randomdigit,emyg,4,86.507000
randomdigit,emyg,5,89.500000
randomdigit,emyg,6,93.183000
randomdigit,emyg,7,114.973000
randomdigit,emyg,8,113.666000
randomdigit,emyg,9,103.244000
randomdigit,emyg,10,106.445000
randomdigit,emyg,11,106.297000
randomdigit,emyg,12,112.266000
randomdigit,emyg,13,114.769000
randomdigit,emyg,14,115.765000
randomdigit,emyg,15,122.167000
randomdigit,emyg,16,125.328000
randomdigit,emyg,17,124.980000
randomdigit,floaxie,1,56.586000
randomdigit,floaxie,2,60.389000
randomdigit,floaxie,3,67.845000
randomdigit,floaxie,4,75.455000
randomdigit,floaxie,5,84.465000
randomdigit,floaxie,6,90.587000
randomdigit,floaxie,7,99.299000
randomdigit,floaxie,8,106.474000
randomdigit,floaxie,9,116.420000
randomdigit,floaxie,10,122.751000
randomdigit,floaxie,11,121.580000
randomdigit,floaxie,12,123.115000
randomdigit,floaxie,13,127.051000
randomdigit,floaxie,14,127.581000
randomdigit,floaxie,15,128.338000
randomdigit,floaxie,16,129.116000
randomdigit,floaxie,17,130.360000
randomdigit,fmt,1,156.607000
randomdigit,fmt,2,160.052000
randomdigit,fmt,3,163.509000
randomdigit,fmt,4,168.198000
randomdigit,fmt,5,176.101000
randomdigit,fmt,6,172.543000
randomdigit,fmt,7,175.541000
randomdigit,fmt,8,183.713000
randomdigit,fmt,9,179.234000
randomdigit,fmt,10,188.711000
randomdigit,fmt,11,189.495000
randomdigit,fmt,12,191.026000
randomdigit,fmt,13,189.913000
randomdigit,fmt,14,193.202000
randomdigit,fmt,15,198.991000
randomdigit,fmt,16,198.339000
randomdigit,fmt,17,208.008000
randomdigit,fpconv,1,134.834000
randomdigit,fpconv,2,146.113000
randomdigit,fpconv,3,160.360000
randomdigit,fpconv,4,168.947000
randomdigit,fpconv,5,176.363000
randomdigit,fpconv,6,183.241000
randomdigit,fpconv,7,185.908000
randomdigit,fpconv,8,192.346000
randomdigit,fpconv,9,196.746000
randomdigit,fpconv,10,195.299000
randomdigit,fpconv,11,203.289000
randomdigit,fpconv,12,205.299000
randomdigit,fpconv,13,201.323000
randomdigit,fpconv,14,206.981000
randomdigit,fpconv,15,210.435000
randomdigit,fpconv,16,215.937000
randomdigit,fpconv,17,222.430000
randomdigit,grisu2,1,133.172000
randomdigit,grisu2,2,142.659000
randomdigit,grisu2,3,138.255000
randomdigit,grisu2,4,139.564000
randomdigit,grisu2,5,140.096000
randomdigit,grisu2,6,146.621000
randomdigit,grisu2,7,145.542000
randomdigit,grisu2,8,147.327000
randomdigit,grisu2,9,153.559000
randomdigit,grisu2,10,154.715000
randomdigit,grisu2,11,161.652000
randomdigit,grisu2,12,163.502000
randomdigit,grisu2,13,162.321000
randomdigit,grisu2,14,166.763000
randomdigit,grisu2,15,169.261000
randomdigit,grisu2,16,170.470000
randomdigit,grisu2,17,179.727000
randomdigit,milo,1,66.229000
randomdigit,milo,2,72.613000
randomdigit,milo,3,75.784000
randomdigit,milo,4,81.617000
randomdigit,milo,5,83.389000
randomdigit,milo,6,86.761000
randomdigit,milo,7,88.853000
randomdigit,milo,8,91.481000
randomdigit,milo,9,96.891000
randomdigit,milo,10,97.263000
randomdigit,milo,11,99.919000
randomdigit,milo,12,106.595000
randomdigit,milo,13,107.479000
randomdigit,milo,14,111.092000
randomdigit,milo,15,112.477000
randomdigit,milo,16,118.193000
randomdigit,milo,17,118.912000
randomdigit,null,1,1.392000
randomdigit,null,2,1.393000
randomdigit,null,3,1.393000
randomdigit,null,4,1.393000
randomdigit,null,5,1.393000
randomdigit,null,6,1.393000
randomdigit,null,7,1.432000
randomdigit,null,8,1.432000
randomdigit,null,9,1.432000
randomdigit,null,10,1.432000
randomdigit,null,11,1.432000
randomdigit,null,12,1.432000
randomdigit,null,13,1.392000
randomdigit,null,14,1.393000
randomdigit,null,15,1.393000
randomdigit,null,16,1.392000
randomdigit,null,17,1.393000
randomdigit,ryu,1,82.881000
randomdigit,ryu,2,85.618000
randomdigit,ryu,3,83.567000
randomdigit,ryu,4,80.965000
randomdigit,ryu,5,80.309000
randomdigit,ryu,6,74.497000
randomdigit,ryu,7,71.445000
randomdigit,ryu,8,69.792000
randomdigit,ryu,9,68.148000
randomdigit,ryu,10,67.630000
randomdigit,ryu,11,64.538000
randomdigit,ryu,12,63.439000
randomdigit,ryu,13,60.929000
randomdigit,ryu,14,59.891000
randomdigit,ryu,15,56.418000
randomdigit,ryu,16,56.070000
randomdigit,ryu,17,55.332000
randomdigit,grisu_exact,1,52.650000
randomdigit,grisu_exact,2,56.257000
randomdigit,grisu_exact,3,51.323000
randomdigit,grisu_exact,4,54.192000
randomdigit,grisu_exact,5,53.834000
randomdigit,grisu_exact,6,53.401000
randomdigit,grisu_exact,7,50.782000
randomdigit,grisu_exact,8,54.547000
randomdigit,grisu_exact,9,54.473000
randomdigit,grisu_exact,10,56.021000
randomdigit,grisu_exact,11,52.159000
randomdigit,grisu_exact,12,53.669000
randomdigit,grisu_exact,13,52.814000
randomdigit,grisu_exact,14,53.835000
randomdigit,grisu_exact,15,51.568000
randomdigit,grisu_exact,16,50.865000
randomdigit,grisu_exact,17,54.455000
</textarea>
</div>
<div class="row" id="downloadDD" style="display: none">
<div class="btn-group pull-right" >
    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-picture"></span></button>
    <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
    </ul>
</div>
</div>
<form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
</form>
</div>
</body>
</html>