<html>
<head>
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://www.google.com/jsapi?autoload={%22modules%22:[{%22name%22:%22visualization%22,%22version%22:%221%22,%22packages%22:[%22controls%22,%22charteditor%22]}]}"></script>
<script src="https://web.archive.org/web/20160324220311/http://jquery-csv.googlecode.com/git/src/jquery.csv.js"></script>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
$(function() {
	google.load("visualization", "1", {packages:["corechart"]});

    var csv = $('#textInput').val();
    var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
    });

    // Convert data for bar chart (summing all digits)
    var timeData = {};	// type -> table
    var funcRowMap;
    var maxDigit = 0;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
      var digit = data[i][2];
   		var time = data[i][3];
   		if (timeData[type] == null) {
   			timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
        if (digit != 0)
   			  funcRowMap = {};
   		}

   		var table = timeData[type];
   		
      if (digit != 0) {
     		if (funcRowMap[func] == null)
     			funcRowMap[func] = table.push([func, 0]) - 1;
     		
     		table[funcRowMap[func]][1] += time;
      }
      else 
        table.push([func, time]);

      maxDigit = Math.max(maxDigit, digit);
    }

    // Compute average
    for (var type in timeData) {
      var table = timeData[type];
      for (var i = 1; i < table.length; i++)
        table[i][1] /= maxDigit;
    }

    // Convert data for drawing line chart per random digit
    var timeDigitData = {}; // type -> table
    var funcColumnMap;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
		  var digit = data[i][2];
   		var time = data[i][3];

      if (digit == 0)
        continue;

   		if (timeDigitData[type] == null) {
   			timeDigitData[type] = [["Digit"]];
   			funcColumnMap = {};
   		}

   		var table = timeDigitData[type];

   		if (funcColumnMap[func] == null)
   			funcColumnMap[func] = table[0].push(func) - 1;

   		var row;
   		for (row = 1; row < table.length; row++)
   			if (table[row][0] == digit)
   				break;

    	if (row == table.length)
    		table.push([digit]);

		table[row][funcColumnMap[func]] = time;
	}

	for (var type in timeData) {
		$("#main").append(
      $("<a>", {name: type}),
      $("<h2>", {style: "padding-top: 70px; margin-top: -70px;"}).append(type)
    );

    $("#section").append($("<li>").append($("<a>", {href: "#" + type}).append(type)));

		drawTable(type, timeData[type]);
		drawBarChart(type, timeData[type]);
    if (timeDigitData[type] != null)
		  drawDigitChart(type, timeDigitData[type]);
	}

	$(".chart").each(function() {
		var chart = $(this);
		var d = $("#downloadDD").clone().css("display", "");
		$('li a', d).each(function() {
	        $(this).click(function() {
	            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
	            svg=sanitize(svg);
	            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
	            $('#imageGetFormTYPE').val($(this).attr('dltype'));
	            $('#imageGetFormSVG').val(svg);
	            $('#imageGetForm').submit();
	        });
	    });		
		$(this).after(d);
	});

  // Add configurations
  var thisConfig = "unknown_win64_vc2019";
  var configurations = ["corei7920@2.67_cygwin32_gcc4.8","corei7920@2.67_cygwin64_gcc4.8","corei7920@2.67_win32_vc2013","corei7920@2.67_win64_vc2013","unknown_mac32_clang7.0","unknown_mac64_clang7.0","unknown_win64_vc2019"];

  for (var i in configurations) {
    var c = configurations[i];
    $("#configuration").append($("<li>", {class : (c == thisConfig ? "active" : "")}).append($("<a>", {href: c + ".html"}).append(c)));
  }
});

function drawTable(type, timeData) {
	var data = google.visualization.arrayToDataTable(timeData);
    data.addColumn('number', 'Speedup');
    data.sort([{ column: 1, desc: true }]);
    var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
    formatter1.format(data, 1);

	var div = document.createElement("div");
	div.className = "tablechart";
	$("#main").append(div);
    var table = new google.visualization.Table(div);
    redrawTable(0);
    table.setSelection([{ row: 0, column: null}]);

    function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
            data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({suffix: 'x'});
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
    }

    google.visualization.events.addListener(table, 'select',
    function() {
        var selection = table.getSelection();
        if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
                redrawTable(item.row);
        }
    });

}

function drawBarChart(type, timeData) {
    var defaultColors = ["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"];

	var data = google.visualization.arrayToDataTable(timeData);
	data.addColumn({ type: "string", role: "style" })
	for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
		data.setValue(rowIndex, 2, defaultColors[rowIndex]);

    data.sort([{ column: 1, desc: true }]);
	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '70%'},
		width: 800,
		height: 300,
		legend: { position: "none" },
		hAxis: { title: "Time (ns)" }
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_time");
	$("#main").append(div);
	var chart = new google.visualization.BarChart(div);

	chart.draw(data, options);
}

function drawDigitChart(type, timeDigitData) {
	var data = google.visualization.arrayToDataTable(timeDigitData);

	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '80%'},
		hAxis: {
			title: "Digit",
			gridlines: { count: timeDigitData.length - 1 },
			maxAlternation: 1,
			minTextSpacing: 0
		},
		vAxis: {
			title: "Time (ns) in log scale",
			logScale: true,
			minorGridlines: { count: 10 },
      baseline: 0
		},
		width: 800,
		height: 600
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_timedigit");
	$("#main").append(div);
	var chart = new google.visualization.LineChart(div);

	chart.draw(data, options);
}

// http://jsfiddle.net/P6XXM/
function sanitize(svg) {
    svg = svg
        .replace(/\<svg/,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
    /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
    /* This fails in IE < 8
    .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
    return s2 +'.'+ s3[0];
    })*/

    // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
            return s.toLowerCase();
        });

    // IE9 beta bugs with innerHTML. Test again with final IE9.
    svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
    if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
    }

    return svg;
}
</script>
<style type="text/css">
@media (min-width: 800px) {
  .container {
    max-width: 800px;
  }
}
textarea {
	font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
.tablechart {
	width: 700px;
	margin: auto;
	padding-top: 20px;
	padding-bottom: 20px;
}
.chart {
	padding-top: 20px;
	padding-bottom: 20px;
}
body { padding-top: 70px; }
</style>
</head>
<body>
<div class="container">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/miloyip/dtoa-benchmark"><span class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="configuration">
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="section">
          </ul>
        </li>
      </ul>
      <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo Yip</a></p>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="page-header">
<h1 id="title">unknown_win64_vc2019</h1>
</div>
<div id="main"></div>
<h2>Source CSV</h2>
<textarea id="textInput" class="form-control" rows="5" readonly>
  Type,Function,Digit,Time(ns)
randomdigit,doubleconv,1,99.887000
randomdigit,doubleconv,2,115.760000
randomdigit,doubleconv,3,125.311000
randomdigit,doubleconv,4,123.525000
randomdigit,doubleconv,5,129.497000
randomdigit,doubleconv,6,134.609000
randomdigit,doubleconv,7,141.525000
randomdigit,doubleconv,8,140.626000
randomdigit,doubleconv,9,145.354000
randomdigit,doubleconv,10,148.224000
randomdigit,doubleconv,11,142.772000
randomdigit,doubleconv,12,146.658000
randomdigit,doubleconv,13,146.119000
randomdigit,doubleconv,14,150.444000
randomdigit,doubleconv,15,154.826000
randomdigit,doubleconv,16,159.741000
randomdigit,doubleconv,17,170.219000
randomdigit,emyg,1,70.311000
randomdigit,emyg,2,77.172000
randomdigit,emyg,3,81.355000
randomdigit,emyg,4,90.644000
randomdigit,emyg,5,85.895000
randomdigit,emyg,6,90.107000
randomdigit,emyg,7,95.255000
randomdigit,emyg,8,130.524000
randomdigit,emyg,9,99.534000
randomdigit,emyg,10,104.515000
randomdigit,emyg,11,105.288000
randomdigit,emyg,12,112.003000
randomdigit,emyg,13,112.694000
randomdigit,emyg,14,117.171000
randomdigit,emyg,15,117.917000
randomdigit,emyg,16,116.919000
randomdigit,emyg,17,124.891000
randomdigit,floaxie,1,49.532000
randomdigit,floaxie,2,58.677000
randomdigit,floaxie,3,64.882000
randomdigit,floaxie,4,73.865000
randomdigit,floaxie,5,81.000000
randomdigit,floaxie,6,88.850000
randomdigit,floaxie,7,97.592000
randomdigit,floaxie,8,106.095000
randomdigit,floaxie,9,111.873000
randomdigit,floaxie,10,116.910000
randomdigit,floaxie,11,118.386000
randomdigit,floaxie,12,120.480000
randomdigit,floaxie,13,122.582000
randomdigit,floaxie,14,123.820000
randomdigit,floaxie,15,119.621000
randomdigit,floaxie,16,126.394000
randomdigit,floaxie,17,129.549000
randomdigit,fmt,1,111.833000
randomdigit,fmt,2,121.313000
randomdigit,fmt,3,130.246000
randomdigit,fmt,4,137.957000
randomdigit,fmt,5,115.766000
randomdigit,fmt,6,120.895000
randomdigit,fmt,7,124.826000
randomdigit,fmt,8,124.487000
randomdigit,fmt,9,125.293000
randomdigit,fmt,10,127.670000
randomdigit,fmt,11,129.803000
randomdigit,fmt,12,134.034000
randomdigit,fmt,13,138.363000
randomdigit,fmt,14,139.610000
randomdigit,fmt,15,138.621000
randomdigit,fmt,16,144.663000
randomdigit,fmt,17,153.823000
randomdigit,fpconv,1,134.827000
randomdigit,fpconv,2,144.467000
randomdigit,fpconv,3,158.407000
randomdigit,fpconv,4,166.998000
randomdigit,fpconv,5,172.973000
randomdigit,fpconv,6,176.014000
randomdigit,fpconv,7,183.302000
randomdigit,fpconv,8,188.817000
randomdigit,fpconv,9,190.273000
randomdigit,fpconv,10,194.227000
randomdigit,fpconv,11,195.142000
randomdigit,fpconv,12,196.432000
randomdigit,fpconv,13,203.282000
randomdigit,fpconv,14,198.920000
randomdigit,fpconv,15,201.793000
randomdigit,fpconv,16,208.010000
randomdigit,fpconv,17,218.106000
randomdigit,grisu2,1,130.752000
randomdigit,grisu2,2,140.712000
randomdigit,grisu2,3,139.742000
randomdigit,grisu2,4,136.904000
randomdigit,grisu2,5,141.946000
randomdigit,grisu2,6,142.155000
randomdigit,grisu2,7,147.950000
randomdigit,grisu2,8,144.020000
randomdigit,grisu2,9,149.486000
randomdigit,grisu2,10,157.008000
randomdigit,grisu2,11,155.938000
randomdigit,grisu2,12,161.376000
randomdigit,grisu2,13,162.708000
randomdigit,grisu2,14,162.774000
randomdigit,grisu2,15,168.928000
randomdigit,grisu2,16,172.689000
randomdigit,grisu2,17,179.335000
randomdigit,milo,1,63.742000
randomdigit,milo,2,69.876000
randomdigit,milo,3,75.116000
randomdigit,milo,4,78.103000
randomdigit,milo,5,80.779000
randomdigit,milo,6,84.080000
randomdigit,milo,7,85.691000
randomdigit,milo,8,89.855000
randomdigit,milo,9,93.822000
randomdigit,milo,10,96.768000
randomdigit,milo,11,98.420000
randomdigit,milo,12,101.122000
randomdigit,milo,13,103.412000
randomdigit,milo,14,106.118000
randomdigit,milo,15,108.136000
randomdigit,milo,16,111.712000
randomdigit,milo,17,117.420000
randomdigit,ryu,1,80.068000
randomdigit,ryu,2,81.532000
randomdigit,ryu,3,80.082000
randomdigit,ryu,4,78.231000
randomdigit,ryu,5,77.181000
randomdigit,ryu,6,77.354000
randomdigit,ryu,7,69.487000
randomdigit,ryu,8,65.956000
randomdigit,ryu,9,63.591000
randomdigit,ryu,10,64.455000
randomdigit,ryu,11,60.823000
randomdigit,ryu,12,61.199000
randomdigit,ryu,13,60.105000
randomdigit,ryu,14,58.197000
randomdigit,ryu,15,55.531000
randomdigit,ryu,16,52.669000
randomdigit,ryu,17,53.725000
randomdigit,grisu_exact,1,47.565000
randomdigit,grisu_exact,2,51.437000
randomdigit,grisu_exact,3,47.834000
randomdigit,grisu_exact,4,49.045000
randomdigit,grisu_exact,5,49.859000
randomdigit,grisu_exact,6,50.672000
randomdigit,grisu_exact,7,49.215000
randomdigit,grisu_exact,8,52.285000
randomdigit,grisu_exact,9,51.119000
randomdigit,grisu_exact,10,55.062000
randomdigit,grisu_exact,11,49.741000
randomdigit,grisu_exact,12,51.182000
randomdigit,grisu_exact,13,51.071000
randomdigit,grisu_exact,14,51.208000
randomdigit,grisu_exact,15,50.081000
randomdigit,grisu_exact,16,48.236000
randomdigit,grisu_exact,17,52.124000
</textarea>
</div>
<div class="row" id="downloadDD" style="display: none">
<div class="btn-group pull-right" >
    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-picture"></span></button>
    <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
    </ul>
</div>
</div>
<form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
</form>
</div>
</body>
</html>