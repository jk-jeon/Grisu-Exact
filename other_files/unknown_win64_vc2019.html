<html>
<head>
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://www.google.com/jsapi?autoload={%22modules%22:[{%22name%22:%22visualization%22,%22version%22:%221%22,%22packages%22:[%22controls%22,%22charteditor%22]}]}"></script>
<script src="https://web.archive.org/web/20160324220311/http://jquery-csv.googlecode.com/git/src/jquery.csv.js"></script>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
$(function() {
	google.load("visualization", "1", {packages:["corechart"]});

    var csv = $('#textInput').val();
    var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
    });

    // Convert data for bar chart (summing all digits)
    var timeData = {};	// type -> table
    var funcRowMap;
    var maxDigit = 0;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
      var digit = data[i][2];
   		var time = data[i][3];
   		if (timeData[type] == null) {
   			timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
        if (digit != 0)
   			  funcRowMap = {};
   		}

   		var table = timeData[type];
   		
      if (digit != 0) {
     		if (funcRowMap[func] == null)
     			funcRowMap[func] = table.push([func, 0]) - 1;
     		
     		table[funcRowMap[func]][1] += time;
      }
      else 
        table.push([func, time]);

      maxDigit = Math.max(maxDigit, digit);
    }

    // Compute average
    for (var type in timeData) {
      var table = timeData[type];
      for (var i = 1; i < table.length; i++)
        table[i][1] /= maxDigit;
    }

    // Convert data for drawing line chart per random digit
    var timeDigitData = {}; // type -> table
    var funcColumnMap;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
		  var digit = data[i][2];
   		var time = data[i][3];

      if (digit == 0)
        continue;

   		if (timeDigitData[type] == null) {
   			timeDigitData[type] = [["Digit"]];
   			funcColumnMap = {};
   		}

   		var table = timeDigitData[type];

   		if (funcColumnMap[func] == null)
   			funcColumnMap[func] = table[0].push(func) - 1;

   		var row;
   		for (row = 1; row < table.length; row++)
   			if (table[row][0] == digit)
   				break;

    	if (row == table.length)
    		table.push([digit]);

		table[row][funcColumnMap[func]] = time;
	}

	for (var type in timeData) {
		$("#main").append(
      $("<a>", {name: type}),
      $("<h2>", {style: "padding-top: 70px; margin-top: -70px;"}).append(type)
    );

    $("#section").append($("<li>").append($("<a>", {href: "#" + type}).append(type)));

		drawTable(type, timeData[type]);
		drawBarChart(type, timeData[type]);
    if (timeDigitData[type] != null)
		  drawDigitChart(type, timeDigitData[type]);
	}

	$(".chart").each(function() {
		var chart = $(this);
		var d = $("#downloadDD").clone().css("display", "");
		$('li a', d).each(function() {
	        $(this).click(function() {
	            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
	            svg=sanitize(svg);
	            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
	            $('#imageGetFormTYPE').val($(this).attr('dltype'));
	            $('#imageGetFormSVG').val(svg);
	            $('#imageGetForm').submit();
	        });
	    });		
		$(this).after(d);
	});

  // Add configurations
  var thisConfig = "unknown_win64_vc2019";
  var configurations = ["corei7920@2.67_cygwin32_gcc4.8","corei7920@2.67_cygwin64_gcc4.8","corei7920@2.67_win32_vc2013","corei7920@2.67_win64_vc2013","unknown_mac32_clang7.0","unknown_mac64_clang7.0","unknown_win64_vc2019"];

  for (var i in configurations) {
    var c = configurations[i];
    $("#configuration").append($("<li>", {class : (c == thisConfig ? "active" : "")}).append($("<a>", {href: c + ".html"}).append(c)));
  }
});

function drawTable(type, timeData) {
	var data = google.visualization.arrayToDataTable(timeData);
    data.addColumn('number', 'Speedup');
    data.sort([{ column: 1, desc: true }]);
    var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
    formatter1.format(data, 1);

	var div = document.createElement("div");
	div.className = "tablechart";
	$("#main").append(div);
    var table = new google.visualization.Table(div);
    redrawTable(0);
    table.setSelection([{ row: 0, column: null}]);

    function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
            data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({suffix: 'x'});
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
    }

    google.visualization.events.addListener(table, 'select',
    function() {
        var selection = table.getSelection();
        if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
                redrawTable(item.row);
        }
    });

}

function drawBarChart(type, timeData) {
    var defaultColors = ["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"];

	var data = google.visualization.arrayToDataTable(timeData);
	data.addColumn({ type: "string", role: "style" })
	for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
		data.setValue(rowIndex, 2, defaultColors[rowIndex]);

    data.sort([{ column: 1, desc: true }]);
	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '70%'},
		width: 800,
		height: 300,
		legend: { position: "none" },
		hAxis: { title: "Time (ns)" }
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_time");
	$("#main").append(div);
	var chart = new google.visualization.BarChart(div);

	chart.draw(data, options);
}

function drawDigitChart(type, timeDigitData) {
	var data = google.visualization.arrayToDataTable(timeDigitData);

	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '80%'},
		hAxis: {
			title: "Digit",
			gridlines: { count: timeDigitData.length - 1 },
			maxAlternation: 1,
			minTextSpacing: 0
		},
		vAxis: {
			title: "Time (ns) in log scale",
			logScale: true,
			minorGridlines: { count: 10 },
      baseline: 0
		},
		width: 800,
		height: 600
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_timedigit");
	$("#main").append(div);
	var chart = new google.visualization.LineChart(div);

	chart.draw(data, options);
}

// http://jsfiddle.net/P6XXM/
function sanitize(svg) {
    svg = svg
        .replace(/\<svg/,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
    /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
    /* This fails in IE < 8
    .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
    return s2 +'.'+ s3[0];
    })*/

    // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
            return s.toLowerCase();
        });

    // IE9 beta bugs with innerHTML. Test again with final IE9.
    svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
    if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
    }

    return svg;
}
</script>
<style type="text/css">
@media (min-width: 800px) {
  .container {
    max-width: 800px;
  }
}
textarea {
	font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
.tablechart {
	width: 700px;
	margin: auto;
	padding-top: 20px;
	padding-bottom: 20px;
}
.chart {
	padding-top: 20px;
	padding-bottom: 20px;
}
body { padding-top: 70px; }
</style>
</head>
<body>
<div class="container">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/miloyip/dtoa-benchmark"><span class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="configuration">
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="section">
          </ul>
        </li>
      </ul>
      <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo Yip</a></p>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="page-header">
<h1 id="title">unknown_win64_vc2019</h1>
</div>
<div id="main"></div>
<h2>Source CSV</h2>
<textarea id="textInput" class="form-control" rows="5" readonly>
  Type,Function,Digit,Time(ns)
randomdigit,doubleconv,1,97.755000
randomdigit,doubleconv,2,108.565000
randomdigit,doubleconv,3,115.734000
randomdigit,doubleconv,4,120.402000
randomdigit,doubleconv,5,125.775000
randomdigit,doubleconv,6,136.591000
randomdigit,doubleconv,7,147.629000
randomdigit,doubleconv,8,146.918000
randomdigit,doubleconv,9,149.598000
randomdigit,doubleconv,10,140.974000
randomdigit,doubleconv,11,145.618000
randomdigit,doubleconv,12,144.861000
randomdigit,doubleconv,13,151.726000
randomdigit,doubleconv,14,154.584000
randomdigit,doubleconv,15,151.381000
randomdigit,doubleconv,16,162.580000
randomdigit,doubleconv,17,168.108000
randomdigit,emyg,1,69.756000
randomdigit,emyg,2,77.179000
randomdigit,emyg,3,80.506000
randomdigit,emyg,4,81.904000
randomdigit,emyg,5,88.287000
randomdigit,emyg,6,91.191000
randomdigit,emyg,7,93.637000
randomdigit,emyg,8,96.450000
randomdigit,emyg,9,100.119000
randomdigit,emyg,10,100.012000
randomdigit,emyg,11,108.023000
randomdigit,emyg,12,107.220000
randomdigit,emyg,13,109.397000
randomdigit,emyg,14,114.133000
randomdigit,emyg,15,116.589000
randomdigit,emyg,16,116.444000
randomdigit,emyg,17,138.739000
randomdigit,floaxie,1,49.412000
randomdigit,floaxie,2,57.615000
randomdigit,floaxie,3,65.255000
randomdigit,floaxie,4,73.706000
randomdigit,floaxie,5,80.033000
randomdigit,floaxie,6,89.579000
randomdigit,floaxie,7,95.947000
randomdigit,floaxie,8,105.154000
randomdigit,floaxie,9,112.375000
randomdigit,floaxie,10,120.368000
randomdigit,floaxie,11,118.198000
randomdigit,floaxie,12,120.054000
randomdigit,floaxie,13,120.695000
randomdigit,floaxie,14,122.014000
randomdigit,floaxie,15,123.396000
randomdigit,floaxie,16,126.344000
randomdigit,floaxie,17,127.227000
randomdigit,fmt,1,103.566000
randomdigit,fmt,2,105.808000
randomdigit,fmt,3,114.816000
randomdigit,fmt,4,113.113000
randomdigit,fmt,5,114.566000
randomdigit,fmt,6,117.333000
randomdigit,fmt,7,119.972000
randomdigit,fmt,8,124.941000
randomdigit,fmt,9,169.364000
randomdigit,fmt,10,169.450000
randomdigit,fmt,11,173.366000
randomdigit,fmt,12,182.094000
randomdigit,fmt,13,178.506000
randomdigit,fmt,14,183.437000
randomdigit,fmt,15,179.856000
randomdigit,fmt,16,152.759000
randomdigit,fmt,17,158.220000
randomdigit,fpconv,1,130.938000
randomdigit,fpconv,2,146.919000
randomdigit,fpconv,3,153.074000
randomdigit,fpconv,4,164.614000
randomdigit,fpconv,5,176.891000
randomdigit,fpconv,6,175.583000
randomdigit,fpconv,7,190.205000
randomdigit,fpconv,8,191.651000
randomdigit,fpconv,9,191.739000
randomdigit,fpconv,10,189.676000
randomdigit,fpconv,11,199.497000
randomdigit,fpconv,12,202.558000
randomdigit,fpconv,13,203.725000
randomdigit,fpconv,14,204.756000
randomdigit,fpconv,15,212.249000
randomdigit,fpconv,16,211.236000
randomdigit,fpconv,17,222.341000
randomdigit,grisu2,1,129.101000
randomdigit,grisu2,2,134.314000
randomdigit,grisu2,3,134.698000
randomdigit,grisu2,4,139.953000
randomdigit,grisu2,5,139.419000
randomdigit,grisu2,6,141.505000
randomdigit,grisu2,7,144.119000
randomdigit,grisu2,8,148.082000
randomdigit,grisu2,9,148.002000
randomdigit,grisu2,10,158.922000
randomdigit,grisu2,11,159.563000
randomdigit,grisu2,12,160.718000
randomdigit,grisu2,13,161.945000
randomdigit,grisu2,14,166.500000
randomdigit,grisu2,15,167.397000
randomdigit,grisu2,16,181.141000
randomdigit,grisu2,17,177.482000
randomdigit,milo,1,63.626000
randomdigit,milo,2,69.408000
randomdigit,milo,3,75.056000
randomdigit,milo,4,81.764000
randomdigit,milo,5,100.265000
randomdigit,milo,6,95.674000
randomdigit,milo,7,85.078000
randomdigit,milo,8,87.277000
randomdigit,milo,9,91.755000
randomdigit,milo,10,94.493000
randomdigit,milo,11,97.401000
randomdigit,milo,12,101.040000
randomdigit,milo,13,128.715000
randomdigit,milo,14,130.653000
randomdigit,milo,15,134.347000
randomdigit,milo,16,111.410000
randomdigit,milo,17,115.218000
randomdigit,null,1,1.433000
randomdigit,null,2,1.393000
randomdigit,null,3,1.392000
randomdigit,null,4,1.393000
randomdigit,null,5,1.432000
randomdigit,null,6,1.432000
randomdigit,null,7,1.432000
randomdigit,null,8,1.392000
randomdigit,null,9,1.393000
randomdigit,null,10,1.393000
randomdigit,null,11,1.393000
randomdigit,null,12,1.393000
randomdigit,null,13,1.393000
randomdigit,null,14,1.392000
randomdigit,null,15,1.392000
randomdigit,null,16,1.393000
randomdigit,null,17,1.393000
randomdigit,ryu,1,80.200000
randomdigit,ryu,2,80.304000
randomdigit,ryu,3,78.967000
randomdigit,ryu,4,74.672000
randomdigit,ryu,5,76.272000
randomdigit,ryu,6,72.088000
randomdigit,ryu,7,69.409000
randomdigit,ryu,8,66.886000
randomdigit,ryu,9,65.641000
randomdigit,ryu,10,66.073000
randomdigit,ryu,11,59.976000
randomdigit,ryu,12,61.131000
randomdigit,ryu,13,58.872000
randomdigit,ryu,14,54.833000
randomdigit,ryu,15,53.626000
randomdigit,ryu,16,53.729000
randomdigit,ryu,17,54.145000
randomdigit,grisu_exact,1,49.991000
randomdigit,grisu_exact,2,51.737000
randomdigit,grisu_exact,3,49.921000
randomdigit,grisu_exact,4,50.205000
randomdigit,grisu_exact,5,48.897000
randomdigit,grisu_exact,6,51.113000
randomdigit,grisu_exact,7,46.889000
randomdigit,grisu_exact,8,51.859000
randomdigit,grisu_exact,9,51.419000
randomdigit,grisu_exact,10,52.594000
randomdigit,grisu_exact,11,50.283000
randomdigit,grisu_exact,12,52.572000
randomdigit,grisu_exact,13,51.021000
randomdigit,grisu_exact,14,51.253000
randomdigit,grisu_exact,15,50.048000
randomdigit,grisu_exact,16,49.610000
randomdigit,grisu_exact,17,53.376000
</textarea>
</div>
<div class="row" id="downloadDD" style="display: none">
<div class="btn-group pull-right" >
    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-picture"></span></button>
    <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
    </ul>
</div>
</div>
<form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
</form>
</div>
</body>
</html>